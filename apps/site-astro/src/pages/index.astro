---
import picDavid from "@/assets/david-and-lucy.jpg";
import {
  HannaLogo,
  JblLogo,
  NixonLogo,
  PumaLogo,
  SajeLogo,
  SalesforceLogo,
  ShiseidoLogo,
  ShopifyLogo,
  TherabodyLogo,
} from "@/components/homepage/BrandLogos";

import PortableText from "@/components/PortableText/PortableText.astro";
import MediaTile from "@/components/content/MediaTile.astro";
import {
  Popover,
  PopoverContent,
  PopoverTrigger,
} from "@/components/content/Popover";
import SanityImage from "@/components/content/SanityImage.astro";
import TagsList from "@/components/content/TagsList.astro";
import { DemandPdxCareer, ShopifyCareer } from "@/components/homepage/Career";
import CareerProjectBlock from "@/components/homepage/CareerProjectBlock.astro";
import Slider from "@/components/util/Slider.astro";
import { getProject } from "@/queries/project";
import { getBooksList } from "@/queries/resource";
import { Image } from "astro:assets";
import Layout from "../layouts/Layout.astro";

const currentProjectIds = ["space-madness", "poly-love-life"];
const currentProjects = await Promise.all(currentProjectIds.map(getProject));

const recentBooks = await getBooksList({ order: "recent", limit: 6 });

const logoCloud = [
  {
    logo: ShopifyLogo,
    alt: "Shopify",
  },
  {
    logo: TherabodyLogo,
    alt: "Therabody",
  },
  {
    logo: SalesforceLogo,
    alt: "Salesforce",
  },
  {
    logo: HannaLogo,
    alt: "Hanna Andersson",
  },
  {
    logo: PumaLogo,
    alt: "Puma",
  },
  {
    logo: SajeLogo,
    alt: "Saje Natural Wellness",
  },
  {
    logo: NixonLogo,
    alt: "Nixon",
  },
  {
    logo: JblLogo,
    alt: "JBL",
  },
  {
    logo: ShiseidoLogo,
    alt: "Shiseido",
  },
];
---

<Layout>
  <main>
    {/* Main Header */}
    <header class="content-container max-w-[900px]">
      <div
        class="flex flex-col items-center gap-5 sm:grid sm:grid-cols-2 sm:gap-10"
      >
        <Image
          src={picDavid}
          width={600}
          class="w-full max-w-[400px] rounded-full"
          alt="David and Lucy - my dog"
        />
        <div
          class="text-balance flex flex-col items-center justify-center gap-5 text-center text-2xl sm:text-start"
        >
          <p>developer advocate, full stack engineer, dubious philosopher</p>
          <p>
            Currently developing <a href="https://spacemadness.dev/"
              >Space Madness</a
            > and writing my journey along the way
          </p>
          <p>
            I built and write for <a href="https://polylove.life/"
              >PolyLove.life</a
            > to educate people about <Popover>
              <PopoverTrigger>polyamory</PopoverTrigger><PopoverContent>
                The expansion of romantic relationships beyond two people with
                the consent and knowledge of all parties involved.
              </PopoverContent>
            </Popover>
          </p>
        </div>
      </div>
    </header>

    {/* Currently obsessed  */}
    <section class="mx-auto my-20 w-full max-w-[1200px] p-4">
      <h2 class="mb-5 text-2xl font-semibold md:text-4xl">
        Currently obsessing over...
      </h2>
      <div
        class="flex flex-col items-center gap-5 sm:grid sm:grid-cols-2 sm:gap-10"
      >
        {
          currentProjects.map((project) => {
            return (
              <figure>
                {project.mainImage && (
                  <SanityImage
                    image={project.mainImage}
                    width={600}
                    height={400}
                    class="w-full rounded-sm"
                    alt={`${project.title} homepage`}
                  />
                )}
                <figcaption>
                  <h3 class="my-4 text-xl font-semibold">{project.title}</h3>
                  {project.body && <PortableText value={project.body} />}
                  {project.tags && (
                    <TagsList
                      tags={project.tags}
                      asLinks={true}
                      className="my-4"
                    />
                  )}
                </figcaption>
              </figure>
            );
          })
        }
      </div>
    </section>

    {/* Past work */}
    <section class="mx-auto my-20 w-full max-w-[1200px] p-4">
      <h2 class="mb-5 text-2xl font-semibold md:text-4xl">
        In the past I've done some things...
      </h2>
      <div class="past-projects-grid grid max-w-[900px] gap-5 sm:gap-10">
        <ShopifyCareer />

        <CareerProjectBlock projectId={"shopify-workshops"} />
        <CareerProjectBlock projectId={"hydrogen-tutorial-series"} />

        <DemandPdxCareer />

        <CareerProjectBlock projectId={"therabody"} />
        <CareerProjectBlock projectId={"saje"} />
      </div>
    </section>

    {/* Logo cloud */}
    <section class="mx-auto my-20 w-full max-w-[1200px] p-4">
      <div class="mx-auto max-w-7xl px-6 lg:px-8">
        <h2 class="mb-5 text-2xl font-semibold md:text-4xl">
          Trusted by talented folks at...
        </h2>
        <div
          class="logo-cloud mx-auto mt-10 grid max-w-lg grid-cols-4 items-center gap-x-8 gap-y-10 text-black dark:text-white sm:max-w-xl sm:grid-cols-6 sm:gap-x-10 lg:mx-0 lg:max-w-none lg:grid-cols-5"
        >
          {
            logoCloud.map((logo) => (
              <logo.logo
                aria-label={logo.alt}
                className="col-span-2 max-h-12 w-full object-contain  lg:col-span-1"
                width={158}
                height={48}
                color={"currentColor"}
              />
            ))
          }
        </div>
      </div>
    </section>

    {/* Recently read */}
    <section class="mx-auto my-20 w-full max-w-[1200px] py-4">
      <h2 class="mx-2 mb-5 text-2xl font-semibold md:text-4xl">
        Reading and studying...
      </h2>
      <div>
        <Slider class="gap-6">
          {
            recentBooks.map((book) => (
              <MediaTile
                title={book.title}
                subtitle={book.creator}
                media={book.mainImage}
                format="book"
                class="p-2"
              />
            ))
          }
        </Slider>
      </div>
    </section>
  </main>
</Layout>

<style>
  .past-projects-grid {
    grid-template-columns: 1fr;
  }

  @media (min-width: 600px) {
    .past-projects-grid {
      grid-template-columns: 1fr 2fr;
    }
  }
  @media (min-width: 850px) {
    .past-projects-grid {
      grid-template-columns: minmax(400px, 1fr) 2fr;
    }
  }
</style>
